<script lang="ts">
	import type { MediaItem, MediaSize } from '$lib/graphql/generated'
	import type { ImageSize } from '$lib/types/wp-types'
	import { findImageSizeData, getSrcSet } from '$lib/utilities/utilities'
	type ImageSizeName = 'thumbnail' | 'medium' | 'medium_large' | 'large'  | 'x_large'
	interface Props {
		imageObject: MediaItem;
		lazy?: boolean;
		imageSize?: ImageSizeName;
		fit?: 'cover' | 'contain' | 'fill' | 'none';
		extraClasses?: string;
		shadow?: boolean;
		aspect?: 'square' | 'video' | 'auto'
	}

	let {
		imageObject,
		lazy = true,
		imageSize = 'thumbnail',
		fit = 'none',
		extraClasses = '',
		shadow = false,
		aspect = 'auto'
	}: Props = $props();
	const sizes = imageObject?.mediaDetails?.sizes
		?.filter((size): size is MediaSize => size !== null && typeof size.name === 'string')
		.map(size => ({
			sourceUrl: size.sourceUrl ?? '',
			width: parseInt(size.width ?? '0'),
			height: parseInt(size.height ?? '0'),
			name: size.name as ImageSize['name']
		})) ?? []
	const src = findImageSizeData('sourceUrl', sizes, imageSize)
	const width = findImageSizeData('width', sizes, imageSize)
	const height = findImageSizeData('height', sizes, imageSize)
	const altText = imageObject.altText ?? ''

	function determineSizes(sizeName: ImageSizeName): string {
		switch (sizeName) {
			case 'thumbnail':
				return '(max-width: 600px) 50vw, (max-width: 1200px) 50vw, 25vw'
			case 'medium':
				return '(max-width: 600px) 100vw, (max-width: 1200px) 50vw, 33vw'
			case 'medium_large':
				return '(max-width: 600px) 100vw, (max-width: 1200px) 50vw, 33vw'
			case 'large':
				return '(max-width: 1200px) 100vw, 50vw'
			default:
				return '100vw' // Fallback size for any unhandled cases
		}
	}

	const srcsetLabels = determineSizes(imageSize)


</script>
<div class="relative w-full max-w-none flex justify-center {aspect === 'square' ? 'aspect-square' : `h-full aspect-${aspect}`}">
  <img
    loading={lazy ? 'lazy' : 'eager'}
    class={`${fit === 'contain' ? 'w-auto' : 'w-full'} h-full ${
      fit === 'cover' ? 'object-cover' : 
      fit === 'contain' ? 'object-contain' : 
      fit === 'fill' ? 'object-fill' : 
      'object-none'
    } ${shadow ? 'drop-shadow-lg' : ''} ${extraClasses}`}
    {src}
    alt={altText}
    {width}
    {height}
    srcset={getSrcSet(sizes)}
    sizes={srcsetLabels}
  />
</div>
