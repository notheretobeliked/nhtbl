<script lang="ts">
  import { onMount } from 'svelte'
  import { inview } from 'svelte-inview'
  import { animationQueue } from '$lib/utilities/animationQueue'
  import { draw } from 'svelte/transition'
  import { quintOut } from 'svelte/easing'

  export let version: 'line' | 'bubble' = 'bubble'
  export let content: string = ''
  export let stroke: string = 'black'

  if (stroke === null) stroke = 'black'

  let isInView: boolean = false
  const options = {
    rootMargin: '40px',
    unobserveOnEnter: true,
  }

  function startAnimation(): Promise<void> {
    return new Promise(resolve => {
      isInView = true
      setTimeout(() => {
        resolve()
      }, 1200) // Adjust according to your animation duration
    })
  }

  const handleChange = ({ detail }: { detail: { inView: boolean } }) => {
    if (detail.inView) {
      animationQueue.add(startAnimation)
    }
  }
</script>

{#if version === 'bubble'}
  <span class="relative inline-block">
    {content}
    <div class="absolute -inset-10">
      <svg
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        use:inview={options}
        on:inview_change={handleChange}
        data-inview={isInView}
        viewBox="0 0 258 112"
        style="enable-background:new 0 0 410.15 185.09;"
        xml:space="preserve"
        class="w-full h-full"
        preserveAspectRatio="none"
      >
        {#if isInView}
          <path
            class="stroke-{stroke} fill-none stroke-2"
            transition:draw={{ delay: 0, duration: 2000, easing: quintOut }}
            d="M6.12006 43.5407C12.9312 28.7711 24.4306 16.5371 38.9151 8.65051C42.5395 6.64224 46.3449 4.96302 50.2833 3.63394C54.3338 2.31082 58.8335 1.38277 63.1215 2.27321C71.569 4.03527 75.1766 13.1592 73.3471 20.7781C71.5177 28.397 65.0023 35.1505 56.8886 36.1413L57.7231 36.6053C56.0991 34.0218 57.2994 30.7673 59.4177 28.8108C61.7735 26.6411 65.0665 25.757 68.0963 24.8979C75.3691 22.8286 82.674 20.7968 90.0945 19.3044C97.5024 17.7051 105.079 16.9726 112.664 17.1222C118.634 17.3229 124.86 18.0503 129.996 21.2107C134.444 23.9322 137.416 28.8923 134.611 33.8525C133.256 36.2416 130.997 38.0225 128.66 39.4522C127.509 40.1483 126.322 40.7866 125.104 41.3648C123.647 42.0608 121.708 43.246 120.027 42.9073C118.743 42.6628 118.101 41.4526 118.005 40.2548C117.98 39.5419 118.121 38.8327 118.418 38.181C118.715 37.5292 119.16 36.9518 119.719 36.4924C122.081 34.3039 125.592 33.0624 128.493 31.7267C135.096 28.6902 141.868 26.0189 148.778 23.7253C161.038 19.6556 174.704 15.705 187.742 18.1318C190.87 18.6826 193.899 19.6821 196.728 21.0979C199.296 22.4147 202.422 24.2332 203.327 27.1177C204.977 32.3977 198.089 35.464 194.058 36.7182C192.235 37.2825 187.427 38.775 187.594 35.4139C187.722 32.9056 189.975 30.6732 191.985 29.4253C197.595 25.9327 203.82 23.4876 210.343 22.214C222.539 19.8688 235.378 22.3896 244.865 30.4914C253.325 37.7466 257.999 48.6764 255.277 59.5937C254.029 64.7102 251.336 69.3816 247.503 73.0757C243.787 76.6061 238.645 79.3465 233.336 79.1646C230.769 79.0768 228.15 78.1863 226.673 75.9853L226.77 76.7127C227.527 74.2734 230.621 74.4553 232.547 75.3771C235.557 76.8131 236.167 79.7666 235.114 82.7514C233.728 86.5139 230.281 89.342 227.135 91.7249C224.072 94.0365 220.827 96.1081 217.43 97.9203C203.584 105.339 187.581 108.48 171.854 108.073C167.925 107.972 164.005 107.647 160.114 107.101C156.185 106.549 152.007 105.846 148.707 103.57C145.831 101.557 143.572 97.3873 145.382 94.0199C146.582 91.7624 150.235 90.7027 152.398 92.2704C155.877 94.7787 151.904 98.9738 149.561 100.535C146.223 102.761 142.096 104.059 138.289 105.282C121.833 110.524 104.183 111.049 87.4305 106.793C85.3636 106.262 83.3138 105.656 81.2811 104.975C79.4654 104.472 77.7351 103.712 76.1458 102.717C72.8207 100.385 73.5397 96.6411 76.3192 94.2269C77.6669 93.0619 79.2943 92.2487 81.05 91.8628C82.8217 91.474 85.2994 91.4426 86.6346 92.841C89.2022 95.506 84.8051 99.049 82.6868 100.291C80.8348 101.268 78.8864 102.06 76.8712 102.655C74.7101 103.403 72.5276 104.089 70.3238 104.711C65.988 105.937 61.5917 106.947 57.1518 107.74C48.1651 109.339 38.8702 110.368 29.7551 110.098C21.7312 109.86 13.0655 107.671 8.41164 100.692C6.48591 97.776 5.45888 94.1767 6.42174 90.7529C7.35251 87.4419 9.92653 84.3442 13.2966 83.228C14.9616 82.6198 16.7946 82.6135 18.464 83.2104C20.1334 83.8073 21.5291 84.9679 22.3988 86.4825C24.4273 90.1634 21.3269 93.6123 17.668 94.4652C14.0091 95.318 10.1769 93.744 7.49375 91.3298C4.63008 88.6634 2.77861 85.1257 2.24291 81.2967C1.51113 77.0012 2.01824 72.5553 2.88482 68.3225C3.72563 64.1609 4.95907 60.0842 6.56936 56.1448C7.42524 54.0838 8.37745 52.0647 9.4259 50.0873C10.2817 48.286 11.3317 46.5791 12.5583 44.9955C14.1246 43.1582 17.5331 40.2674 20.2612 41.2833C22.2383 42.0169 22.1485 44.4939 21.5066 46.0992C20.8369 47.6912 19.683 49.0439 18.2007 49.9744C16.7733 50.9426 15.0832 51.4738 13.3457 51.5006C11.6082 51.5274 9.9018 51.0485 8.44376 50.1249C7.02258 49.1603 5.90462 47.8279 5.21526 46.2772C4.5259 44.7266 4.29235 43.019 4.54091 41.3459C4.74632 40.1608 2.89128 39.6529 2.68587 40.8443C1.47266 47.7421 7.53862 54.4204 14.805 53.2603C16.5129 52.9965 18.135 52.3496 19.5439 51.3704C20.9528 50.3912 22.1101 49.1063 22.9252 47.6167C24.3438 44.845 24.2925 40.5182 20.6529 39.4647C17.7322 38.6182 14.5611 40.5496 12.4942 42.3869C9.50929 45.0457 7.71195 49.0527 6.07508 52.5831C2.4162 60.4716 -0.343946 69.5955 0.0347803 78.3431C0.368573 85.9495 4.3548 94.0199 12.4493 96.1457C14.1674 96.6376 15.983 96.7091 17.7361 96.3536C19.4891 95.9982 21.1257 95.2269 22.5016 94.1077C23.7963 93.0081 24.6396 91.4878 24.8756 89.8278C25.1116 88.1678 24.7243 86.4805 23.7854 85.0779C22.8447 83.6408 21.5091 82.4913 19.9313 81.7605C18.3535 81.0298 16.5972 80.7473 14.8628 80.9455C11.403 81.3593 8.44373 83.4851 6.47949 86.2442C2.03748 92.5149 4.48962 100.422 9.89448 105.313C16.4163 111.22 25.5827 112.211 34.1008 111.967C43.67 111.718 53.1936 110.585 62.5438 108.581C67.2598 107.571 71.9127 106.298 76.4796 104.768C80.2541 103.514 84.1825 102.26 86.9555 99.325C88.9968 97.1866 90.3512 93.9384 87.9826 91.5053C85.4149 88.8842 80.774 89.574 77.7827 91.01C74.9134 92.3895 72.2045 95.0421 71.9157 98.2966C71.5883 101.99 74.6823 104.417 77.834 105.721C85.8515 109.045 94.8639 110.669 103.51 111.277C112.456 111.913 121.448 111.28 130.207 109.396C134.682 108.433 139.073 107.131 143.341 105.502C147.025 104.097 150.935 102.592 153.56 99.5632C155.595 97.2117 156.558 93.6248 154.022 91.2169C152 89.2855 148.675 89.3357 146.319 90.5898C143.373 92.1262 142.371 95.4685 143.033 98.5286C143.822 102.172 146.634 104.969 149.997 106.524C153.688 108.223 157.835 108.756 161.847 109.245C166.04 109.759 170.261 110.017 174.486 110.016C182.75 110.039 190.983 109.036 198.988 107.032C206.92 105.052 214.51 101.94 221.512 97.7949C225.009 95.7448 228.305 93.3854 231.359 90.7466C234.254 88.2007 237.034 84.9148 237.47 81.0019C237.68 79.5867 237.434 78.143 236.767 76.8701C236.1 75.5973 235.045 74.5584 233.747 73.8972C231.655 72.7998 228.772 72.3672 226.686 73.7593C225.877 74.3048 224.76 75.5652 224.902 76.6187C225.107 77.9481 227.084 79.2712 228.195 79.8418C231.192 81.3782 234.864 81.3531 238.08 80.5567C251.888 77.1329 259.796 61.638 257.652 48.5385C255.258 33.934 241.733 22.7596 227.257 20.2011C218.775 18.8031 210.066 19.6209 202.011 22.5715C197.909 23.9582 194.006 25.855 190.399 28.2151C188.011 29.8392 185.527 32.8053 185.681 35.8215C185.709 36.4545 185.9 37.0702 186.237 37.6118C186.574 38.1533 187.045 38.603 187.607 38.9192C189.321 39.8598 191.323 39.4272 193.114 38.9631C196.324 38.1166 199.598 36.8374 202.178 34.7367C204.534 32.8178 206.03 30.0148 205.259 26.9923C204.367 23.3365 200.695 21.0038 197.499 19.3985C190.014 15.636 181.38 15.0591 173.106 15.9621C164.209 16.9341 155.544 19.4549 147.115 22.3081C142.609 23.834 138.167 25.5061 133.789 27.3246C129.431 29.0526 125.179 31.0249 121.054 33.2317C118.101 34.8997 115.379 37.6212 116.195 41.2206C116.324 41.9237 116.625 42.586 117.072 43.1514C117.519 43.7168 118.098 44.1687 118.762 44.4687C120.688 45.2275 122.614 44.4688 124.385 43.71C130.413 41.0638 138.071 36.5238 137.57 29.0679C137.121 22.3018 130.13 18.3513 124.141 16.6958C119.963 15.5295 115.469 15.2347 111.143 15.1783C106.256 15.143 101.374 15.4953 96.5457 16.2318C86.5576 17.6866 76.807 20.4018 67.127 23.1609C63.5901 24.1705 59.6937 25.3682 57.2352 28.2277C55.0335 30.7924 54.1219 34.5485 55.9899 37.5271C56.0743 37.6699 56.1961 37.7882 56.3427 37.8697C56.4894 37.9513 56.6557 37.9932 56.8244 37.9911C64.5273 37.0505 70.9463 31.7204 73.9505 24.7725C77.0573 17.5863 76.0816 8.18646 69.4571 3.10718C61.9917 -2.63051 51.5415 0.711765 43.7808 4.07913C26.2892 11.7775 12.278 25.4514 4.38043 42.5311C3.87333 43.6285 5.53593 44.5816 6.04303 43.478L6.12006 43.5407Z"
          />
        {/if}
      </svg>
    </div>
  </span>
{/if}

{#if version === 'line'}
  <span class="relative inline-block">
    <strong>{content}</strong>
    <div class="absolute left-0 right-0 -bottom-1">
      <svg
        width="373"
        height="12"
        viewBox="0 0 373 12"
        xmlns="http://www.w3.org/2000/svg"
        class="w-full"
        use:inview={options}
        on:inview_change={handleChange}
        data-inview={isInView}
      >
        {#if isInView}
          <path
            class="stroke-{stroke}  fill-none stroke-2"
            transition:draw={{ delay: 0, duration: 2000, easing: quintOut }}
            d="M2.12999 9.19996C50.2 10.81 98.29 11.51 146.38 11.29C194.47 11.07 242.56 9.94995 290.61 7.90995C317.58 6.76995 344.53 5.32993 371.47 3.60993C373.38 3.48993 373.42 0.639934 371.47 0.609934C368.24 0.569934 365.01 0.51996 361.78 0.47996C359.85 0.44996 359.85 3.44996 361.78 3.47996C365.01 3.51996 368.24 3.56993 371.47 3.60993C371.47 2.60993 371.47 1.60993 371.47 0.609934C323.47 3.66993 275.42 5.81995 227.34 7.05995C179.26 8.29995 131.16 8.62996 83.07 8.03996C56.08 7.70996 29.1 7.08995 2.12 6.18995C0.199999 6.13995 0.199994 9.13996 2.12999 9.19996Z"
          />
        {/if}
      </svg>
    </div>
  </span>
{/if}
