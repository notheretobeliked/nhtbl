<script lang="ts">
  import { inview } from 'svelte-inview'

  import { draw } from 'svelte/transition'
  import { quintOut } from 'svelte/easing'

  export let version: 'line' | 'bubble' = 'bubble'
  export let content: string = ''
  export let stroke: string = "black"

  if (stroke === null) stroke = "black"

  let startDraw = false
  let isInView: boolean
  const options: Options = {
    rootMargin: '40px',
    unobserveOnEnter: true,
  }
  

  const handleChange = ({ detail }: CustomEvent<ObserverEventDetails>) => {
    isInView = detail.inView
    console.log('isInView changed to:', isInView)
  }
</script>

{#if version === 'bubble'}
  <span class="relative inline-block">
    <strong>{content}</strong>
    <div class="absolute -inset-10">
      <svg
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        use:inview={options}
        on:inview_change={handleChange}
        data-inview={isInView}
        viewBox="0 0 410.15 185.09"
        style="enable-background:new 0 0 410.15 185.09;"
        xml:space="preserve"
        class="w-full h-full"
        preserveAspectRatio="none"
      >
        {#if isInView}
          <path
            class="stroke-{stroke} fill-none  stroke-2"
            transition:draw={{ delay: 500, duration: 4000, easing: quintOut }}
            d="M34.09,43.67c12.54-4.12,23.27-12.96,29.85-24.4c1.59-2.76,2.93-5.68,4-8.69c0.91-2.56,2.66-5.83,0.05-7.85
               c-4.35-3.38-10.22,2.06-11.87,5.9c-4.7,10.96-1.11,23.39,6.17,32.29c7.83,9.57,19.71,14.68,32.04,13.31
               c13.11-1.46,24.98-9.04,33.12-19.25c4.07-5.11,8.51-11.71,9.32-18.34c0.61-5.01-1.94-9.67-7.03-10.79
               c-4.32-0.95-9.08,0.42-12.49,3.15c-4.29,3.43-5.4,8.82-4.08,14.02c3.11,12.23,16.76,19.09,28.3,20.68
               c22.32,3.07,46.39-10.2,55.04-31.13c1.07-2.6,1.88-5.28,2.43-8.04c0.17-0.85-0.24-1.55-1.05-1.85
               c-10.99-4.08-20.67,6.47-22.6,16.49c-2.45,12.69,7.22,22.9,18.01,27.87c11.83,5.44,25.9,7,38.75,5.26
               c12.32-1.66,26-7.61,31.43-19.61c2.5-5.53,3-12.87-1.86-17.33c-3.75-3.44-9.38-3.69-13.95-1.9c-5.15,2.02-8.78,6.28-9.56,11.79
               c-0.9,6.32,1.85,12.64,6.06,17.26c9.69,10.62,26.77,11.09,40.1,10.39c12.25-0.64,25.21-3.33,35.35-10.61
               c8.32-5.97,17.21-17.52,12.33-28.28c-2.32-5.11-8.21-6.73-13.01-3.94c-5.47,3.17-9.02,9.85-11.65,15.37
               c-2.61,5.49-4.77,11.77-3.89,17.93c0.94,6.6,5.74,10.7,11.87,12.64c6.52,2.06,13.39,3.45,20.12,4.64c6.6,1.16,13.3,1.96,20,1.97
               c12.42,0.02,25.23-2.88,34.49-11.64c0.82-0.77,2.43-1.93,2.59-3.1c0.16-1.12-0.8-2.7-1.36-3.63c-1.38-2.28-3.46-4.11-5.81-5.34
               c-4.9-2.55-11-2.84-16.06-0.59c-12.26,5.46-16.66,21.27-15.2,33.59c1.49,12.56,8.44,24.14,18.1,32.17
               c9.65,8.02,22.24,12.83,34.88,11.31c1.16-0.14,2.79-0.06,3.55-1.09c0.74-1.01,1.02-2.64,1.08-3.86c0.13-2.47-0.93-4.8-2.47-6.67
               c-3.63-4.42-9.81-6.79-15.4-7.14c-12.02-0.76-24.45,5.62-33.09,13.51c-9.07,8.28-15.6,19.65-17.63,31.8
               c-0.98,5.87-0.89,11.81,0.32,17.64c0.12,0.6,0.83,1.15,1.45,1.1c7.6-0.59,10.86-9.91,7.84-16.21
               c-4.01-8.37-14.93-10.63-23.27-11.25c-9.56-0.71-19.26,1.02-28.06,4.77c-4.48,1.9-8.71,4.32-12.59,7.26
               c-3.29,2.49-6.67,5.26-8.88,8.79c-3.44,5.5-5.82,16.64,2.8,18.68c0.63,0.15,1.37-0.09,1.69-0.69c3.86-7.09-0.12-14.18-5.91-18.72
               c-7.3-5.72-16.1-7.31-25.17-7.54c-10.21-0.26-20.5,1.39-30.12,4.82c-8.34,2.98-18.5,7.27-23.3,15.19
               c-3.52,5.82-2.96,16.09,4.49,18.73c3,1.06,5.96-4.01,6.83-6.29c1.27-3.34,1.25-7.18,0.29-10.6c-2.35-8.32-10.35-12.99-18.09-15.48
               c-8.93-2.87-18.93-4.51-28.29-3.35c-9.37,1.16-18.11,5.62-22.62,14.21c-3.87,7.37-4.22,16.62,1.53,23.11
               c0.43,0.48,1.28,0.57,1.82,0.23c6.93-4.3,8.67-13.3,6.27-20.71c-2.82-8.72-11.1-13.89-19.53-16.26
               c-10.11-2.85-21.19-2.7-31.49-1.01c-5.71,0.94-11.32,2.47-16.7,4.59c-4.33,1.7-8.98,3.58-12.37,6.88
               c-2.97,2.9-4.55,6.97-3.19,11.04c0.94,2.82,4.24,6.7,7.55,5.09c6.5-3.15,9.18-10.63,8.67-17.48c-0.6-8.05-4.86-15.01-11.81-19.12
               c-8.46-5.01-18.75-5.66-28.34-5.01c-8.64,0.58-20.44,1.43-24.28,10.71c-1.57,3.8-1.31,8.4,1.81,11.36
               c2.53,2.4,6.09,2.83,9.33,1.77c7.96-2.59,12.42-10.39,13.5-18.27c1.11-8.11-0.86-16.38-4.81-23.49
               c-3.99-7.18-10.06-13.35-17.33-17.21c-3.47-1.84-7.23-3.18-11.12-3.79c-3.41-0.54-8.31-1.36-11.05,1.25
               c-5.11,4.87-1.77,14.28,4.6,16.07c4.22,1.18,8.7-0.35,12.03-2.99c3.73-2.95,5.85-7.28,6.94-11.84c1.28-5.32,1.42-10.92,1.74-16.36
               c0.34-5.63,0.56-11.29,0.3-16.93C26.28,59,25.53,53.28,23.9,47.81c-1.35-4.55-3.21-9.51-7.01-12.59
               c-3.05-2.47-7.22-3.25-10.83-1.51c-3.65,1.77-5.13,5.97-3.4,9.65c3.97,8.43,16.29,8.86,23.9,6.24c4.2-1.44,7.96-3.89,10.92-7.21
               c1.28-1.44-0.83-3.57-2.12-2.12c-5.2,5.83-13.34,8.82-21.08,7.43c-3.57-0.64-8.22-2.6-9.24-6.51c-1.04-4,3.45-5.97,6.72-5.29
               c4.06,0.84,6.46,5.14,7.86,8.67c1.72,4.34,2.78,8.96,3.36,13.58c1.16,9.12,0.61,18.37-0.01,27.51c-0.54,8.03-0.99,18.11-8.68,22.8
               c-2.94,1.8-7.29,2.73-10.21,0.35c-2.1-1.71-3.05-4.91-2.41-7.52c0.28-1.14,0.94-2.37,2.03-2.91c1.29-0.64,3.33-0.35,4.75-0.27
               c3.32,0.19,6.6,0.96,9.69,2.18c6.27,2.47,11.76,6.84,15.93,12.1c4.13,5.21,7.03,11.46,8.08,18.04c1,6.32,0.35,13.86-3.61,19.11
               c-3.13,4.15-12.77,10.46-15.59,2.43c-1.23-3.5,0.72-7.61,3.44-9.84c3.35-2.74,7.92-3.6,12.1-4.12
               c13.75-1.72,33.95-2.1,41.26,12.42c2.58,5.11,3.29,11.77,0.82,17.07c-0.59,1.26-1.35,2.43-2.31,3.43c-0.7,0.74-2.35,2.45-3.45,2.5
               c-1.22,0.05-2.52-1.83-2.94-2.76c-0.7-1.56-0.82-3.44-0.25-5.06c1.33-3.76,5.29-5.99,8.67-7.61c4.19-2.01,8.59-3.6,13.06-4.83
               c8.95-2.45,18.28-3.36,27.53-2.67c7.81,0.59,16.23,2.41,22.37,7.58c5.24,4.41,8.03,11.33,6.35,18.12
               c-0.78,3.16-2.56,5.88-5.35,7.61c0.61,0.08,1.21,0.16,1.82,0.23c-4.44-5-4.33-12.19-1.75-18.06c3-6.83,8.89-11.24,16-13.19
               c7.99-2.19,16.56-1.38,24.56,0.3c7.36,1.55,15.43,3.81,20.57,9.68c4.56,5.22,5.59,15.14-1.03,19.21c0.39-0.05,0.77-0.1,1.16-0.15
               c-3.08-1.18-4.68-4.4-4.92-7.54c-0.28-3.63,1.3-6.93,3.71-9.57c5.37-5.87,13.82-9.32,21.21-11.79c8-2.67,16.41-4.09,24.84-4.17
               c7.78-0.07,15.7,0.61,22.57,4.53c5.88,3.35,12.68,10.01,8.74,17.24c0.56-0.23,1.13-0.46,1.69-0.69
               c-6.22-1.48-3.48-10.12-1.26-13.87c1.8-3.03,4.63-5.42,7.36-7.59c3.16-2.5,6.63-4.64,10.25-6.41c7.15-3.5,15.06-5.51,23.02-5.84
               c7.44-0.3,16.09,0.43,22.48,4.62c3.28,2.16,5.74,5.49,5.46,9.55c-0.23,3.35-2.27,7.11-5.95,7.39c0.48,0.37,0.96,0.73,1.45,1.1
               c-2.97-14.31,1.75-29.33,10.87-40.52c4.49-5.51,10-10.17,16.29-13.49c6.05-3.2,13.43-5.58,20.35-5.14
               c5.83,0.37,17.95,5.33,14.19,13.15c0.3-0.23,0.6-0.46,0.9-0.69c-17.3,3.05-34.67-6.6-44.27-20.73
               c-4.78-7.04-7.79-15.36-7.85-23.92c-0.06-8.88,3.04-19.04,10.47-24.5c6.9-5.07,19.37-4.13,22.32,5.12
               c0.13-0.49,0.26-0.97,0.39-1.46c-9.88,10.89-24.56,13.57-38.67,12.9c-7.47-0.36-14.87-1.57-22.17-3.15
               c-3.6-0.78-7.2-1.63-10.76-2.59c-3.99-1.07-8.1-2.53-10.38-6.23c-3.67-5.96-1.13-13.95,1.53-19.79c1.48-3.25,3.26-6.4,5.29-9.34
               c2.01-2.89,4.93-6.54,8.75-6.77c7-0.41,7.36,8.88,5.93,13.6c-1.86,6.17-7.03,11.51-12.24,15.05c-11.53,7.84-26.33,9.92-39.98,9.72
               c-8.37-0.12-17.28-0.78-24.77-4.85c-6.57-3.57-11.99-10.62-11.54-18.41c0.37-6.38,5.65-11.18,11.99-11.42
               c2.75-0.1,5.53,0.75,7.33,2.93c2.55,3.06,2.48,7.32,1.35,10.94c-2.22,7.09-8.42,12.43-14.87,15.67
               c-6.53,3.28-13.93,4.68-21.19,4.97c-13.86,0.55-30.65-2.12-40.96-12.24c-4.85-4.76-7.76-11.08-6.36-17.91
               c1.19-5.83,4.99-11.94,10.74-14.18c2.68-1.05,5.45-0.96,8.13,0.03c-0.35-0.62-0.7-1.23-1.05-1.85
               c-3.38,16.98-17.31,30.07-33.51,35.13c-7.97,2.49-16.58,3.09-24.73,1.11c-8.88-2.16-18.86-7.86-21.59-17.19
               c-1.12-3.83-0.75-8.02,2.24-10.86c2.4-2.27,5.92-3.56,9.22-3.34c3.45,0.23,6.02,2.43,6.21,6c0.28,5.27-3.41,10.98-6.27,15.18
               c-10.56,15.54-31.94,27.52-50.53,18.96C68.14,44.6,60.9,36.47,58.13,26.99c-1.32-4.52-1.57-9.33-0.38-13.91
               c0.63-2.41,1.5-4.78,3.42-6.47c1.38-1.22,4.27-3.01,5.54-0.8c-0.05-0.39-0.1-0.77-0.15-1.16C62.5,21.4,49.66,35.4,33.29,40.78
               C31.46,41.38,32.25,44.27,34.09,43.67L34.09,43.67z"
          />
        {/if}
      </svg>
    </div>
  </span>
{/if}

{#if version === 'line'}
  <span class="relative inline-block">
    <strong>{content}</strong>
    <div class="absolute left-0 right-0 -bottom-1">
      <svg
        width="373"
        height="12"
        viewBox="0 0 373 12"
        xmlns="http://www.w3.org/2000/svg"
        class="w-full"
        use:inview={options}
        on:inview_change={handleChange}
        data-inview={isInView}
      >
        {#if isInView}
          <path
            class="stroke-{stroke}  fill-none stroke-2"
            transition:draw={{ delay: 500, duration: 4000, easing: quintOut }}
            d="M2.12999 9.19996C50.2 10.81 98.29 11.51 146.38 11.29C194.47 11.07 242.56 9.94995 290.61 7.90995C317.58 6.76995 344.53 5.32993 371.47 3.60993C373.38 3.48993 373.42 0.639934 371.47 0.609934C368.24 0.569934 365.01 0.51996 361.78 0.47996C359.85 0.44996 359.85 3.44996 361.78 3.47996C365.01 3.51996 368.24 3.56993 371.47 3.60993C371.47 2.60993 371.47 1.60993 371.47 0.609934C323.47 3.66993 275.42 5.81995 227.34 7.05995C179.26 8.29995 131.16 8.62996 83.07 8.03996C56.08 7.70996 29.1 7.08995 2.12 6.18995C0.199999 6.13995 0.199994 9.13996 2.12999 9.19996Z"
          />
        {/if}
      </svg>
    </div>
  </span>
{/if}
